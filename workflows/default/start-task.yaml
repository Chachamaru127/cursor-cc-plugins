# /start-task ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
# Cursorï¼ˆPMï¼‰ã‹ã‚‰å—ã‘å–ã£ãŸã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹

phase: start-task
description: "ã‚¿ã‚¹ã‚¯ã‚’é–‹å§‹ã™ã‚‹ãŸã‚ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã†ãƒ•ã‚§ãƒ¼ã‚º"

steps:
  # Step 1: ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèª
  - id: read-context
    skill: ccp-core-read-repo-context
    input:
      files:
        - Plans.md
        - AGENTS.md
      context_from:
        - git_status
        - recent_commits
    mode: required

  # Step 2: é€²è¡Œä¸­ã‚¿ã‚¹ã‚¯ã®ç‰¹å®š
  - id: identify-current-task
    skill: ccp-plans-management
    input:
      files:
        - Plans.md
      filter:
        markers:
          - "cursor:ä¾é ¼ä¸­"
          - "cc:TODO"
          - "cc:WIP"
    output:
      variables:
        - priority_task
        - task_details
        - task_scope
    mode: required

  # Step 3: ã‚¿ã‚¹ã‚¯å†…å®¹ã®ç¢ºèªã¨å ±å‘Š
  - id: report-task
    skill: ccp-task-reporter
    input:
      variables:
        - priority_task
        - task_details
        - task_scope
    output:
      user_message: true
      variables:
        - user_approved
    mode: required

  # Step 4: ã‚¿ã‚¹ã‚¯åˆ†è§£ï¼ˆæ‰¿èªå¾Œï¼‰
  - id: decompose-task
    skill: ccp-plan-feature
    condition: "user_approved"
    input:
      variables:
        - priority_task
    output:
      update_files:
        - Plans.md
      variables:
        - sub_tasks
    mode: optional

  # Step 5: Plans.md ã®çŠ¶æ…‹æ›´æ–°
  - id: update-status
    skill: ccp-plans-management
    condition: "user_approved"
    input:
      files:
        - Plans.md
      action: update_marker
      from: "cursor:ä¾é ¼ä¸­|cc:TODO"
      to: "cc:WIP"
    output:
      update_files:
        - Plans.md
    mode: required

# æˆåŠŸæ™‚ã®å‡ºåŠ›
on_success:
  message: |
    ## ğŸ“‹ æœ¬æ—¥ã®ã‚¿ã‚¹ã‚¯

    **ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¹ã‚¯**: {{priority_task}}

    - **æ¦‚è¦**: {{task_details}}
    - **ã‚¹ã‚³ãƒ¼ãƒ—**: {{task_scope}}

    ---

    ğŸš€ **ä½œæ¥­ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ** (y/n)

    ---

    å®Œäº†ã—ãŸã‚‰ `/handoff-to-cursor` ã§å ±å‘Šã—ã¾ã™ã€‚

# ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
on_empty:
  message: |
    âš ï¸ **é€²è¡Œä¸­ã®ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“**

    ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
    1. Cursor ã§ `/assign-to-cc` ã‚’å®Ÿè¡Œã—ã¦ã‚¿ã‚¹ã‚¯ã‚’ä¾é ¼
    2. `Plans.md` ã«ç›´æ¥ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 

    ã¾ãŸã¯ã€ã‚„ã‚ŠãŸã„ã“ã¨ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚

# ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡ºåŠ›
on_error:
  message: |
    âš ï¸ ã‚¿ã‚¹ã‚¯ã®ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

    Plans.md ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
