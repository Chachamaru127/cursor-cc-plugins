# /sync-status ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©
# Plans.md ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€é€²æ—ã‚µãƒãƒªãƒ¼ã‚’å‡ºåŠ›

phase: sync-status
description: "Plans.md ã®ç¾åœ¨ã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã€é€²æ—ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã™ã‚‹ãƒ•ã‚§ãƒ¼ã‚º"

steps:
  # Step 1: Plans.md ã®èª­ã¿è¾¼ã¿
  - id: read-plans
    skill: ccp-plans-management
    input:
      files:
        - Plans.md
      context_from:
        - git_status
        - current_branch
    output:
      variables:
        - tasks_todo
        - tasks_wip
        - tasks_done
        - tasks_blocked
    mode: required

  # Step 2: ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã®é›†è¨ˆ
  - id: aggregate-status
    skill: ccp-status-aggregator
    input:
      variables:
        - tasks_todo
        - tasks_wip
        - tasks_done
        - tasks_blocked
    output:
      variables:
        - total_tasks
        - progress_percent
        - current_work
        - next_task
    mode: required

  # Step 3: ç•°å¸¸æ¤œçŸ¥
  - id: detect-anomalies
    skill: ccp-status-anomaly-detection
    input:
      variables:
        - tasks_wip
        - tasks_blocked
    output:
      variables:
        - warnings
    mode: optional

  # Step 4: ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
  - id: generate-summary
    skill: ccp-status-summary
    input:
      variables:
        - total_tasks
        - progress_percent
        - current_work
        - next_task
        - warnings
    output:
      user_message: true
    mode: required

# æˆåŠŸæ™‚ã®å‡ºåŠ›
on_success:
  message: |
    ## ğŸ“Š é€²æ—ã‚µãƒãƒªãƒ¼

    **æ›´æ–°æ—¥æ™‚**: {{timestamp}}
    **ãƒ–ãƒ©ãƒ³ãƒ**: {{current_branch}}

    ---

    ### ã‚¿ã‚¹ã‚¯çŠ¶æ³

    | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ä»¶æ•° |
    |-----------|------|
    | ğŸ”´ æœªç€æ‰‹ | {{tasks_todo}} |
    | ğŸŸ¡ ä½œæ¥­ä¸­ | {{tasks_wip}} |
    | ğŸŸ¢ å®Œäº† | {{tasks_done}} |
    | ğŸš« ãƒ–ãƒ­ãƒƒã‚¯ | {{tasks_blocked}} |

    **é€²æ—ç‡**: {{progress_percent}}%

    ---

    ### ç¾åœ¨ã®ä½œæ¥­ä¸­ã‚¿ã‚¹ã‚¯
    {{current_work}}

    ### æ¬¡ã«ç€æ‰‹ã™ã¹ãã‚¿ã‚¹ã‚¯
    {{next_task}}

    {{warnings}}

# ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡ºåŠ›
on_error:
  message: |
    âš ï¸ Plans.md ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚

    `/init` ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€‚
